<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Guide Bot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            200: '#a7f3d0',
                            300: '#6ee7b7',
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669',
                            700: '#047857',
                            800: '#065f46',
                            900: '#064e3b',
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="css/app.css">
</head>
<body class="h-full bg-gray-900">
    <!-- Navigation -->
    <nav class="bg-gray-800/50 backdrop-blur-sm border-b border-gray-700 sticky top-0 z-50">
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
            <div class="flex h-16 items-center justify-between">
                <div class="flex items-center gap-2">
                    <span class="text-2xl">ü§ñ</span>
                    <span class="text-xl font-bold text-white">Guide Bot</span>
                </div>
                <div class="flex items-center gap-4">
                    <span id="user-email" class="text-sm text-gray-400"></span>
                    <button onclick="handleLogout()" class="rounded-lg bg-gray-700 px-4 py-2 text-sm font-medium text-gray-200 hover:bg-gray-600 transition-colors">
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-white">My Portfolio</h1>
            <p class="mt-2 text-gray-400">Track your stocks and download analysis reports</p>
        </div>

        <!-- Messages -->
        <div id="error-message" class="hidden mb-6 p-4 rounded-lg bg-red-500/10 border border-red-500/50 text-red-400 text-sm">
        </div>
        <div id="success-message" class="hidden mb-6 p-4 rounded-lg bg-brand-500/10 border border-brand-500/50 text-brand-400 text-sm">
        </div>

        <!-- Add Ticker Section -->
        <div class="bg-gray-800 rounded-xl p-6 mb-8 border border-gray-700">
            <h2 class="text-lg font-semibold text-white mb-4">Add Ticker</h2>
            <form id="add-ticker-form" class="flex flex-col sm:flex-row gap-4">
                <div class="flex-1">
                    <input type="text" id="ticker-input" placeholder="Enter ticker symbol (e.g., AAPL)" maxlength="5"
                        class="block w-full rounded-lg border-0 bg-gray-700 py-3 px-4 text-white shadow-sm ring-1 ring-inset ring-gray-600 placeholder:text-gray-500 focus:ring-2 focus:ring-inset focus:ring-brand-500 sm:text-sm uppercase transition-all"
                        pattern="[A-Za-z]{1,5}" title="1-5 letter stock ticker">
                </div>
                <button type="submit" id="add-ticker-btn"
                    class="rounded-lg bg-brand-600 px-6 py-3 text-sm font-semibold text-white shadow-sm hover:bg-brand-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap">
                    <span id="add-btn-text">+ Add Ticker</span>
                    <svg id="add-btn-spinner" class="hidden animate-spin inline-block ml-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
            </form>
        </div>

        <!-- Portfolio List -->
        <div class="bg-gray-800 rounded-xl border border-gray-700 overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-700">
                <h2 class="text-lg font-semibold text-white">My Tickers</h2>
            </div>
            
            <!-- Loading State -->
            <div id="loading-state" class="p-12 text-center">
                <svg class="animate-spin h-8 w-8 text-brand-500 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="text-gray-400">Loading portfolio...</p>
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="hidden p-12 text-center">
                <div class="text-5xl mb-4">üìä</div>
                <h3 class="text-lg font-medium text-white mb-2">No tickers yet</h3>
                <p class="text-gray-400 text-sm">Add your first ticker to start tracking and generating analysis reports.</p>
            </div>

            <!-- Ticker List -->
            <div id="ticker-list" class="hidden divide-y divide-gray-700">
                <!-- Tickers will be populated here -->
            </div>
        </div>
    </main>

    <!-- Download Modal -->
    <div id="download-modal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="flex min-h-full items-center justify-center p-4">
            <div class="fixed inset-0 bg-black/60 backdrop-blur-sm" onclick="closeDownloadModal()"></div>
            <div class="relative bg-gray-800 rounded-xl border border-gray-700 p-6 w-full max-w-md shadow-xl">
                <h3 class="text-lg font-semibold text-white mb-4">
                    Generating Report for <span id="modal-ticker" class="text-brand-400"></span>
                </h3>
                <div id="modal-loading" class="text-center py-8">
                    <svg class="animate-spin h-12 w-12 text-brand-500 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="text-gray-400">Generating Excel file...</p>
                    <p class="text-xs text-gray-500 mt-2">This may take a few seconds</p>
                </div>
                <div id="modal-success" class="hidden text-center py-8">
                    <div class="text-5xl mb-4">‚úÖ</div>
                    <p class="text-white font-medium mb-2">Report Ready!</p>
                    <p class="text-gray-400 text-sm mb-4">Your download should start automatically.</p>
                    <button onclick="closeDownloadModal()" class="rounded-lg bg-gray-700 px-4 py-2 text-sm font-medium text-gray-200 hover:bg-gray-600 transition-colors">
                        Close
                    </button>
                </div>
                <div id="modal-error" class="hidden text-center py-8">
                    <div class="text-5xl mb-4">‚ùå</div>
                    <p class="text-white font-medium mb-2">Generation Failed</p>
                    <p id="modal-error-message" class="text-red-400 text-sm mb-4"></p>
                    <button onclick="closeDownloadModal()" class="rounded-lg bg-gray-700 px-4 py-2 text-sm font-medium text-gray-200 hover:bg-gray-600 transition-colors">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/dashboard.js"></script>
    <script>
        // Check authentication
        if (!localStorage.getItem('token')) {
            window.location.href = 'login.html';
        } else {
            // Initialize dashboard
            initDashboard();
        }
    </script>
</body>
</html>
