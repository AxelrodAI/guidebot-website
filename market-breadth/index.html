<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Breadth Dashboard</title>
    <style>
        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #111827;
            --bg-tertiary: #1f2937;
            --bg-card: #161e2e;
            --border-color: #374151;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-yellow: #f59e0b;
            --accent-purple: #8b5cf6;
            --accent-cyan: #06b6d4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            padding: 20px 32px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 22px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header h1 .icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-blue));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .header-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .exchange-select {
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 13px;
        }

        .refresh-btn {
            padding: 8px 16px;
            background: var(--accent-blue);
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .last-update {
            font-size: 12px;
            color: var(--text-muted);
        }

        .main-container {
            padding: 24px;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Alert Banner */
        .alert-banner {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(245, 158, 11, 0.2));
            border: 1px solid var(--accent-red);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .alert-banner.bullish {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(6, 182, 212, 0.2));
            border-color: var(--accent-green);
        }

        .alert-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: rgba(239, 68, 68, 0.3);
        }

        .alert-banner.bullish .alert-icon {
            background: rgba(16, 185, 129, 0.3);
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .alert-desc {
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Summary Cards */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
        }

        .summary-label {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .summary-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .summary-value.positive { color: var(--accent-green); }
        .summary-value.negative { color: var(--accent-red); }
        .summary-value.neutral { color: var(--accent-yellow); }

        .summary-change {
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .summary-change.up { color: var(--accent-green); }
        .summary-change.down { color: var(--accent-red); }

        /* Main Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
        }

        .card-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-title .emoji {
            font-size: 16px;
        }

        .card-body {
            padding: 20px;
        }

        /* Chart Areas */
        .chart-area {
            height: 200px;
            background: var(--bg-secondary);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        .chart-line {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%;
            display: flex;
            align-items: flex-end;
            padding: 0 10px 10px;
            gap: 2px;
        }

        .chart-bar {
            flex: 1;
            border-radius: 2px 2px 0 0;
            transition: height 0.3s ease;
        }

        .chart-bar.green { background: var(--accent-green); }
        .chart-bar.red { background: var(--accent-red); }
        .chart-bar.blue { background: var(--accent-blue); }

        /* A/D Line specific */
        .ad-line-chart {
            height: 200px;
            position: relative;
        }

        .ad-line-path {
            stroke: var(--accent-cyan);
            stroke-width: 2;
            fill: none;
        }

        .ad-line-area {
            fill: url(#adGradient);
        }

        /* Breadth Gauge */
        .gauge-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .gauge {
            width: 180px;
            height: 90px;
            position: relative;
        }

        .gauge-bg {
            position: absolute;
            width: 180px;
            height: 90px;
            border-radius: 90px 90px 0 0;
            background: linear-gradient(90deg, var(--accent-red) 0%, var(--accent-yellow) 50%, var(--accent-green) 100%);
            overflow: hidden;
        }

        .gauge-inner {
            position: absolute;
            width: 140px;
            height: 70px;
            background: var(--bg-card);
            border-radius: 70px 70px 0 0;
            bottom: 0;
            left: 20px;
        }

        .gauge-needle {
            position: absolute;
            width: 4px;
            height: 70px;
            background: white;
            bottom: 0;
            left: 88px;
            transform-origin: bottom center;
            border-radius: 2px;
            transition: transform 0.5s ease;
        }

        .gauge-value {
            font-size: 32px;
            font-weight: 700;
            margin-top: 16px;
        }

        .gauge-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* McClellan Oscillator */
        .mcclellan-chart {
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .mcclellan-zero {
            position: absolute;
            width: 100%;
            height: 1px;
            background: var(--border-color);
            top: 50%;
        }

        .mcclellan-bars {
            display: flex;
            align-items: center;
            gap: 2px;
            height: 100%;
            padding: 10px;
            position: relative;
        }

        .mcclellan-bar {
            width: 8px;
            position: absolute;
            left: 50%;
            transition: all 0.3s;
        }

        /* DMA Stats */
        .dma-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .dma-item {
            text-align: center;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .dma-value {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .dma-label {
            font-size: 12px;
            color: var(--text-muted);
        }

        .dma-bar {
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            margin-top: 12px;
            overflow: hidden;
        }

        .dma-bar-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        /* New Highs/Lows */
        .highs-lows {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .hl-item {
            flex: 1;
            text-align: center;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .hl-value {
            font-size: 28px;
            font-weight: 700;
        }

        .hl-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-top: 4px;
        }

        .hl-ratio {
            font-size: 14px;
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 6px;
            margin-top: 16px;
        }

        .hl-ratio.bullish {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-green);
        }

        .hl-ratio.bearish {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-red);
        }

        /* Sector Breadth */
        .sector-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .sector-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .sector-name {
            width: 60px;
            font-size: 12px;
            font-weight: 600;
        }

        .sector-bar-container {
            flex: 1;
            height: 20px;
            display: flex;
            border-radius: 4px;
            overflow: hidden;
        }

        .sector-bar-up {
            background: var(--accent-green);
            height: 100%;
            transition: width 0.3s;
        }

        .sector-bar-down {
            background: var(--accent-red);
            height: 100%;
            transition: width 0.3s;
        }

        .sector-pct {
            width: 50px;
            text-align: right;
            font-size: 12px;
            font-weight: 600;
        }

        .sector-pct.positive { color: var(--accent-green); }
        .sector-pct.negative { color: var(--accent-red); }

        /* Historical Table */
        .history-table {
            width: 100%;
            border-collapse: collapse;
        }

        .history-table th,
        .history-table td {
            padding: 10px 12px;
            text-align: left;
            font-size: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .history-table th {
            color: var(--text-muted);
            font-weight: 600;
            text-transform: uppercase;
        }

        .history-table td.positive { color: var(--accent-green); }
        .history-table td.negative { color: var(--accent-red); }

        /* Responsive */
        @media (max-width: 1200px) {
            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .summary-grid {
                grid-template-columns: 1fr;
            }
            .dma-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>
            <span class="icon">üìä</span>
            Market Breadth Dashboard
        </h1>
        <div class="header-controls">
            <select class="exchange-select" id="exchangeSelect" onchange="updateData()">
                <option value="nyse">NYSE</option>
                <option value="nasdaq">NASDAQ</option>
                <option value="combined">NYSE + NASDAQ</option>
            </select>
            <button class="refresh-btn" onclick="refreshData()">
                üîÑ Refresh
            </button>
            <span class="last-update">Updated: <span id="lastUpdate">Just now</span></span>
        </div>
    </div>

    <div class="main-container">
        <!-- Alert Banner -->
        <div class="alert-banner" id="alertBanner">
            <div class="alert-icon">‚ö†Ô∏è</div>
            <div class="alert-content">
                <div class="alert-title" id="alertTitle">Bearish Divergence Detected</div>
                <div class="alert-desc" id="alertDesc">S&P 500 making new highs but A/D line failing to confirm. Only 48% of stocks above 50 DMA. Watch for potential reversal.</div>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="summary-grid">
            <div class="summary-card">
                <div class="summary-label">Advancing vs Declining</div>
                <div class="summary-value" id="adRatio">1.8:1</div>
                <div class="summary-change up" id="adChange">
                    ‚Üë 234 more advancers than yesterday
                </div>
            </div>
            <div class="summary-card">
                <div class="summary-label">% Above 50 DMA</div>
                <div class="summary-value" id="above50">48%</div>
                <div class="summary-change down" id="above50Change">
                    ‚Üì 3% from last week
                </div>
            </div>
            <div class="summary-card">
                <div class="summary-label">% Above 200 DMA</div>
                <div class="summary-value positive" id="above200">62%</div>
                <div class="summary-change up" id="above200Change">
                    ‚Üë 1% from last week
                </div>
            </div>
            <div class="summary-card">
                <div class="summary-label">McClellan Oscillator</div>
                <div class="summary-value negative" id="mcclellan">-42</div>
                <div class="summary-change down" id="mcclellanChange">
                    Crossed below zero 3 days ago
                </div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div class="dashboard-grid">
            <!-- Left Column -->
            <div style="display: flex; flex-direction: column; gap: 24px;">
                <!-- A/D Line -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">
                            <span class="emoji">üìà</span>
                            Advance/Decline Line vs S&P 500
                        </span>
                        <select class="exchange-select" style="font-size: 12px; padding: 4px 8px;">
                            <option>1 Month</option>
                            <option selected>3 Months</option>
                            <option>6 Months</option>
                            <option>1 Year</option>
                        </select>
                    </div>
                    <div class="card-body">
                        <div class="chart-area" id="adLineChart">
                            <svg width="100%" height="100%" viewBox="0 0 600 200">
                                <defs>
                                    <linearGradient id="adGradient" x1="0" y1="0" x2="0" y2="1">
                                        <stop offset="0%" stop-color="rgba(6, 182, 212, 0.3)"/>
                                        <stop offset="100%" stop-color="rgba(6, 182, 212, 0)"/>
                                    </linearGradient>
                                    <linearGradient id="spyGradient" x1="0" y1="0" x2="0" y2="1">
                                        <stop offset="0%" stop-color="rgba(245, 158, 11, 0.3)"/>
                                        <stop offset="100%" stop-color="rgba(245, 158, 11, 0)"/>
                                    </linearGradient>
                                </defs>
                                <path id="adArea" class="ad-line-area"/>
                                <path id="adPath" class="ad-line-path"/>
                                <path id="spyPath" stroke="#f59e0b" stroke-width="2" fill="none"/>
                            </svg>
                        </div>
                        <div style="display: flex; gap: 20px; margin-top: 12px; font-size: 12px;">
                            <span style="color: var(--accent-cyan);">‚îÅ‚îÅ A/D Line</span>
                            <span style="color: var(--accent-yellow);">‚îÅ‚îÅ S&P 500</span>
                            <span style="color: var(--accent-red); margin-left: auto;">‚ö†Ô∏è Divergence Zone</span>
                        </div>
                    </div>
                </div>

                <!-- McClellan Oscillator -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">
                            <span class="emoji">üìâ</span>
                            McClellan Oscillator
                        </span>
                        <span style="font-size: 12px; color: var(--text-muted);">
                            Signal: <span style="color: var(--accent-red);">Bearish</span>
                        </span>
                    </div>
                    <div class="card-body">
                        <div class="chart-area" id="mcclellanChart">
                            <div style="position: absolute; top: 50%; width: 100%; border-top: 1px dashed var(--border-color);"></div>
                            <div class="chart-line" id="mcclellanBars"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 12px; font-size: 11px; color: var(--text-muted);">
                            <span>-150 Oversold</span>
                            <span>0 Neutral</span>
                            <span>+150 Overbought</span>
                        </div>
                    </div>
                </div>

                <!-- Sector Breadth -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">
                            <span class="emoji">üè¢</span>
                            Sector Breadth
                        </span>
                    </div>
                    <div class="card-body">
                        <div class="sector-list" id="sectorBreadth"></div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div style="display: flex; flex-direction: column; gap: 24px;">
                <!-- Breadth Gauge -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">
                            <span class="emoji">üéØ</span>
                            Overall Market Health
                        </span>
                    </div>
                    <div class="card-body">
                        <div class="gauge-container">
                            <div class="gauge">
                                <div class="gauge-bg"></div>
                                <div class="gauge-inner"></div>
                                <div class="gauge-needle" id="healthNeedle"></div>
                            </div>
                            <div class="gauge-value" id="healthScore">52</div>
                            <div class="gauge-label">NEUTRAL-BEARISH</div>
                        </div>
                    </div>
                </div>

                <!-- New Highs/Lows -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">
                            <span class="emoji">üîù</span>
                            New Highs vs New Lows
                        </span>
                    </div>
                    <div class="card-body">
                        <div class="highs-lows">
                            <div class="hl-item">
                                <div class="hl-value" style="color: var(--accent-green);" id="newHighs">124</div>
                                <div class="hl-label">52W Highs</div>
                            </div>
                            <div class="hl-item">
                                <div class="hl-value" style="color: var(--accent-red);" id="newLows">89</div>
                                <div class="hl-label">52W Lows</div>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <div class="hl-ratio bullish" id="hlRatio">H/L Ratio: 1.39</div>
                        </div>
                        <div class="chart-area" style="height: 120px; margin-top: 16px;" id="hlChart">
                            <div class="chart-line" id="hlBars"></div>
                        </div>
                    </div>
                </div>

                <!-- DMA Stats -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">
                            <span class="emoji">üìè</span>
                            Moving Average Breakdown
                        </span>
                    </div>
                    <div class="card-body">
                        <div class="dma-grid">
                            <div class="dma-item">
                                <div class="dma-value" id="above20">58%</div>
                                <div class="dma-label">Above 20 DMA</div>
                                <div class="dma-bar">
                                    <div class="dma-bar-fill" id="dma20Bar" style="width: 58%; background: var(--accent-yellow);"></div>
                                </div>
                            </div>
                            <div class="dma-item">
                                <div class="dma-value" id="above50Stat">48%</div>
                                <div class="dma-label">Above 50 DMA</div>
                                <div class="dma-bar">
                                    <div class="dma-bar-fill" id="dma50Bar" style="width: 48%; background: var(--accent-yellow);"></div>
                                </div>
                            </div>
                            <div class="dma-item">
                                <div class="dma-value" id="above100">55%</div>
                                <div class="dma-label">Above 100 DMA</div>
                                <div class="dma-bar">
                                    <div class="dma-bar-fill" id="dma100Bar" style="width: 55%; background: var(--accent-yellow);"></div>
                                </div>
                            </div>
                            <div class="dma-item">
                                <div class="dma-value" id="above200Stat">62%</div>
                                <div class="dma-label">Above 200 DMA</div>
                                <div class="dma-bar">
                                    <div class="dma-bar-fill" id="dma200Bar" style="width: 62%; background: var(--accent-green);"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Historical -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">
                            <span class="emoji">üìÖ</span>
                            Historical Breadth
                        </span>
                    </div>
                    <div class="card-body" style="padding: 0;">
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>A/D</th>
                                    <th>H/L</th>
                                    <th>>50D</th>
                                    <th>McCl</th>
                                </tr>
                            </thead>
                            <tbody id="historyTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize data
        const sectors = [
            { name: 'XLK', fullName: 'Technology', upPct: 68 },
            { name: 'XLF', fullName: 'Financials', upPct: 54 },
            { name: 'XLV', fullName: 'Healthcare', upPct: 45 },
            { name: 'XLE', fullName: 'Energy', upPct: 72 },
            { name: 'XLI', fullName: 'Industrials', upPct: 51 },
            { name: 'XLY', fullName: 'Consumer Disc', upPct: 38 },
            { name: 'XLP', fullName: 'Consumer Stap', upPct: 62 },
            { name: 'XLU', fullName: 'Utilities', upPct: 58 },
            { name: 'XLB', fullName: 'Materials', upPct: 44 },
            { name: 'XLRE', fullName: 'Real Estate', upPct: 35 },
            { name: 'XLC', fullName: 'Comm Services', upPct: 49 }
        ];

        const historicalData = [
            { date: 'Today', ad: '+1.8:1', hl: '124/89', above50: '48%', mccl: -42 },
            { date: 'Yesterday', ad: '+1.2:1', hl: '98/112', above50: '51%', mccl: -28 },
            { date: '2 Days', ad: '-0.8:1', hl: '67/134', above50: '52%', mccl: -15 },
            { date: '3 Days', ad: '+1.5:1', hl: '142/78', above50: '55%', mccl: +8 },
            { date: '1 Week', ad: '+2.1:1', hl: '186/52', above50: '58%', mccl: +45 }
        ];

        function init() {
            renderSectorBreadth();
            renderMcclellanChart();
            renderHLChart();
            renderADLine();
            renderHistoryTable();
            updateHealthGauge(52);
        }

        function renderSectorBreadth() {
            const container = document.getElementById('sectorBreadth');
            container.innerHTML = sectors.map(sector => `
                <div class="sector-item">
                    <span class="sector-name">${sector.name}</span>
                    <div class="sector-bar-container">
                        <div class="sector-bar-up" style="width: ${sector.upPct}%;"></div>
                        <div class="sector-bar-down" style="width: ${100 - sector.upPct}%;"></div>
                    </div>
                    <span class="sector-pct ${sector.upPct >= 50 ? 'positive' : 'negative'}">${sector.upPct}%</span>
                </div>
            `).join('');
        }

        function renderMcclellanChart() {
            const container = document.getElementById('mcclellanBars');
            const values = [-42, -28, -15, 8, 45, 62, 38, -12, -35, -48, -42, -55, -38, -22, -42, 
                           15, 28, 42, 55, 38, 22, -8, -25, -38, -42, -28, -15, 8, 22, -42];
            
            container.innerHTML = values.map((val, i) => {
                const height = Math.abs(val) * 0.6;
                const bottom = val > 0 ? '50%' : `calc(50% - ${height}px)`;
                const color = val > 0 ? 'var(--accent-green)' : 'var(--accent-red)';
                return `<div class="chart-bar" style="height: ${height}px; background: ${color}; flex: 1;"></div>`;
            }).join('');
        }

        function renderHLChart() {
            const container = document.getElementById('hlBars');
            const data = [
                { h: 124, l: 89 }, { h: 98, l: 112 }, { h: 67, l: 134 }, { h: 142, l: 78 },
                { h: 186, l: 52 }, { h: 155, l: 68 }, { h: 112, l: 95 }, { h: 88, l: 120 },
                { h: 145, l: 72 }, { h: 168, l: 58 }, { h: 132, l: 84 }, { h: 108, l: 102 },
                { h: 124, l: 89 }, { h: 156, l: 64 }, { h: 178, l: 48 }
            ];
            
            const maxVal = Math.max(...data.flatMap(d => [d.h, d.l]));
            container.innerHTML = data.map(d => {
                const hHeight = (d.h / maxVal) * 100;
                const lHeight = (d.l / maxVal) * 100;
                return `
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 2px; height: 100%; justify-content: flex-end;">
                        <div class="chart-bar green" style="height: ${hHeight}%;"></div>
                        <div class="chart-bar red" style="height: ${lHeight}%;"></div>
                    </div>
                `;
            }).join('');
        }

        function renderADLine() {
            const adValues = generateSmoothLine(60, 80, 140, 0.3);
            const spyValues = generateSmoothLine(60, 100, 180, 0.2);
            
            const adPath = generatePath(adValues, 600, 200);
            const spyPath = generatePath(spyValues, 600, 200);
            
            document.getElementById('adPath').setAttribute('d', adPath);
            document.getElementById('spyPath').setAttribute('d', spyPath);
            
            // Area fill
            document.getElementById('adArea').setAttribute('d', adPath + ` L 600,200 L 0,200 Z`);
        }

        function generateSmoothLine(points, startY, variance, trend) {
            const values = [];
            let y = startY;
            for (let i = 0; i < points; i++) {
                y += (Math.random() - 0.5 + trend) * variance / 10;
                y = Math.max(20, Math.min(180, y));
                values.push(y);
            }
            return values;
        }

        function generatePath(values, width, height) {
            const step = width / (values.length - 1);
            let path = `M 0,${200 - values[0]}`;
            for (let i = 1; i < values.length; i++) {
                path += ` L ${i * step},${200 - values[i]}`;
            }
            return path;
        }

        function renderHistoryTable() {
            const container = document.getElementById('historyTable');
            container.innerHTML = historicalData.map(row => `
                <tr>
                    <td>${row.date}</td>
                    <td class="${row.ad.startsWith('+') ? 'positive' : 'negative'}">${row.ad}</td>
                    <td>${row.hl}</td>
                    <td>${row.above50}</td>
                    <td class="${row.mccl > 0 ? 'positive' : 'negative'}">${row.mccl > 0 ? '+' : ''}${row.mccl}</td>
                </tr>
            `).join('');
        }

        function updateHealthGauge(score) {
            const needle = document.getElementById('healthNeedle');
            const rotation = (score / 100) * 180 - 90;
            needle.style.transform = `rotate(${rotation}deg)`;
        }

        function refreshData() {
            // Simulate refresh
            document.getElementById('lastUpdate').textContent = 'Just now';
            
            // Randomize some values
            const newHighs = Math.floor(Math.random() * 100) + 80;
            const newLows = Math.floor(Math.random() * 80) + 40;
            document.getElementById('newHighs').textContent = newHighs;
            document.getElementById('newLows').textContent = newLows;
            
            const ratio = (newHighs / newLows).toFixed(2);
            const ratioEl = document.getElementById('hlRatio');
            ratioEl.textContent = `H/L Ratio: ${ratio}`;
            ratioEl.className = `hl-ratio ${ratio >= 1 ? 'bullish' : 'bearish'}`;

            // Update alert
            const alertBanner = document.getElementById('alertBanner');
            if (ratio >= 1.5) {
                alertBanner.className = 'alert-banner bullish';
                document.getElementById('alertTitle').textContent = 'Bullish Breadth Confirmed';
                document.getElementById('alertDesc').textContent = 'Strong breadth with new highs outpacing new lows. Trend likely to continue.';
                document.querySelector('.alert-icon').textContent = '‚úÖ';
            }
        }

        function updateData() {
            refreshData();
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
